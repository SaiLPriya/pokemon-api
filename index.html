<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pokédex — Vanilla JS</title>
  <style>
    :root{
      --bg:#f3f7fb; --card:#fff; --muted:#666; --accent:#ef5350;
    }
    body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:20px;box-sizing:border-box;color:#222}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    h1{margin:0;font-size:1.6rem}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    input{padding:10px;border-radius:8px;border:1px solid #d0d7de;min-width:220px}
    button{padding:9px 12px;border-radius:8px;border:0;cursor:pointer;background:var(--accent);color:#fff}
    button.ghost{background:#fff;color:#333;border:1px solid #d0d7de}
    .status{margin-bottom:12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .card{background:var(--card);border-radius:10px;padding:12px;text-align:center;box-shadow:0 4px 10px rgba(16,24,40,0.04);border:1px solid rgba(0,0,0,0.04)}
    .card h3{margin:6px 0;font-size:1rem}
    img.sprite{width:96px;height:96px;image-rendering:pixelated}
    .meta{font-size:12px;color:var(--muted);margin-bottom:8px}
    .pager{display:flex;gap:8px;justify-content:center;align-items:center;margin-top:16px}
    .modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal-inner{background:#fff;border-radius:10px;padding:18px;max-width:520px;width:92%;box-shadow:0 10px 30px rgba(2,6,23,0.2)}
    ul.stats{padding-left:18px;margin:8px 0}
    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:420px){ input{min-width:140px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Pokédex</h1>
      <div style="flex:1"></div>
      <div style="font-size:13px;color:#555">Data: PokéAPI</div>
    </header>

    <div class="controls">
      <input id="search" placeholder="Search Pokémon by name or id (e.g., pikachu or 25)" />
      <button id="btnSearch">Search</button>
      <button id="btnReset" class="ghost">Reset</button>
      <div style="flex:1"></div>
      <button id="btnRefresh" class="ghost">Refresh</button>
    </div>

    <div id="status" class="status"></div>

    <div id="grid" class="grid"></div>

    <div class="pager">
      <button id="prev" class="ghost">Prev</button>
      <div id="pageInfo">Page 1</div>
      <button id="next" class="ghost">Next</button>
    </div>

    <div id="modalRoot"></div>

    <footer>Tip: click "Details" on a card to see stats & abilities.</footer>
  </div>

<script>
/* Vanilla JS Pokédex */
const LIMIT = 20;
let offset = 0;

const grid = document.getElementById('grid');
const status = document.getElementById('status');
const pageInfo = document.getElementById('pageInfo');

async function fetchList(offset=0){
  status.textContent = 'Loading list...';
  grid.innerHTML = '';
  try {
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=${LIMIT}&offset=${offset}`);
    if(!res.ok) throw new Error('Failed to load list');
    const json = await res.json();

    // Fetch details in parallel
    const detailPromises = json.results.map(r => fetch(r.url).then(r => {
      if(!r.ok) return null;
      return r.json();
    }).catch(()=>null));
    const details = await Promise.all(detailPromises);

    const filtered = details.filter(Boolean);
    renderGrid(filtered);
    pageInfo.textContent = `Page ${Math.floor(offset / LIMIT) + 1}`;
    status.textContent = '';
  } catch (err) {
    status.textContent = 'Error: ' + err.message;
  }
}

function renderGrid(items){
  if(items.length === 0){
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#777">No Pokémon to show</div>';
    return;
  }
  grid.innerHTML = items.map(p => `
    <div class="card" data-name="${p.name}">
      <h3>${p.name.toUpperCase()}</h3>
      <img class="sprite" src="${p.sprites.front_default || ''}" alt="${p.name}">
      <div class="meta">Type: ${p.types.map(t=>t.type.name).join(', ')}</div>
      <button data-name="${p.name}" class="detailBtn">Details</button>
    </div>
  `).join('');

  document.querySelectorAll('.detailBtn').forEach(b=>{
    b.onclick = (e) => openDetails(e.currentTarget.dataset.name);
  });
}

async function openDetails(name){
  const modalRoot = document.getElementById('modalRoot');
  modalRoot.innerHTML = `<div class="modal"><div class="modal-inner">Loading...</div></div>`;
  try {
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
    if(!res.ok) throw new Error('Not found');
    const p = await res.json();

    modalRoot.innerHTML = `
      <div class="modal" onclick="document.getElementById('modalRoot').innerHTML=''">
        <div class="modal-inner" onclick="event.stopPropagation()">
          <h2 style="margin-top:0">${p.name.toUpperCase()} <small style="font-size:12px;color:#666">#${p.id}</small></h2>
          <div style="display:flex;gap:12px;align-items:center">
            <img src="${p.sprites.front_default}" alt="${p.name}" style="width:120px;height:120px;image-rendering:pixelated">
            <div style="flex:1">
              <p><strong>Types:</strong> ${p.types.map(t=>t.type.name).join(', ')}</p>
              <p><strong>Height:</strong> ${p.height} | <strong>Weight:</strong> ${p.weight}</p>
              <p><strong>Abilities:</strong> ${p.abilities.map(a=>a.ability.name).join(', ')}</p>
            </div>
          </div>

          <h4>Stats</h4>
          <ul class="stats">
            ${p.stats.map(s=>`<li>${s.stat.name}: ${s.base_stat}</li>`).join('')}
          </ul>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button onclick="document.getElementById('modalRoot').innerHTML=''" class="ghost">Close</button>
          </div>
        </div>
      </div>
    `;
  } catch (err) {
    modalRoot.innerHTML = `<div class="modal"><div class="modal-inner">Error: ${err.message}<br><button onclick="document.getElementById('modalRoot').innerHTML=''">Close</button></div></div>`;
  }
}

document.getElementById('btnSearch').onclick = async () => {
  const q = document.getElementById('search').value.trim().toLowerCase();
  if(!q){ fetchList(offset); return; }
  status.textContent = 'Searching...';
  try {
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${encodeURIComponent(q)}`);
    if(!res.ok) throw new Error('Pokémon not found');
    const p = await res.json();
    renderGrid([p]);
    status.textContent = '';
    pageInfo.textContent = 'Search results';
  } catch (err) {
    status.textContent = 'Error: ' + err.message;
    grid.innerHTML = '';
    pageInfo.textContent = '';
  }
};

document.getElementById('btnReset').onclick = () => {
  document.getElementById('search').value = '';
  offset = 0;
  fetchList(offset);
};

document.getElementById('next').onclick = () => { offset += LIMIT; fetchList(offset); };
document.getElementById('prev').onclick = () => { offset = Math.max(0, offset - LIMIT); fetchList(offset); };
document.getElementById('btnRefresh').onclick = () => fetchList(offset);

// initial load
fetchList(0);
</script>
</body>
</html>
